<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack åŸç†ç³»åˆ—ä¸ƒï¼šå¦‚ä½•ç¼–å†™loader | duangdongçš„engineering</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?0088ce24040b03f2947322ab31d23414";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script>
  var _hmt = _hmt || [];
  _hmt.push(['_requirePlugin', 'UrlChangeTracker', {
    shouldTrackUrlChange: function (newPath, oldPath) {
      newPath = newPath.split('#')[0];
      oldPath = oldPath.split('#')[0];
      return newPath != oldPath;
    }}
  ]);
  </script>
    <meta name="description" content="å‰ç«¯ç›¸å…³çŸ¥è¯†å½’çº³æ€»ç»“">
    <meta name="keywords" content="qd-blog,node,vuepress,leetcode,algorithm">
    
    <link rel="preload" href="/assets/css/0.styles.b4a844ec.css" as="style"><link rel="preload" href="/assets/js/app.04fd048c.js" as="script"><link rel="preload" href="/assets/js/2.57da4f88.js" as="script"><link rel="preload" href="/assets/js/1.a76cc220.js" as="script"><link rel="preload" href="/assets/js/49.3039c755.js" as="script"><link rel="prefetch" href="/assets/js/10.50f73657.js"><link rel="prefetch" href="/assets/js/11.0390ceee.js"><link rel="prefetch" href="/assets/js/12.f88bec36.js"><link rel="prefetch" href="/assets/js/13.963ad03b.js"><link rel="prefetch" href="/assets/js/14.512f15b9.js"><link rel="prefetch" href="/assets/js/15.a674496c.js"><link rel="prefetch" href="/assets/js/16.ed7e507f.js"><link rel="prefetch" href="/assets/js/17.de667ca5.js"><link rel="prefetch" href="/assets/js/18.b44e84af.js"><link rel="prefetch" href="/assets/js/19.5b5ad6a1.js"><link rel="prefetch" href="/assets/js/20.6800493a.js"><link rel="prefetch" href="/assets/js/21.6589052c.js"><link rel="prefetch" href="/assets/js/22.f648d829.js"><link rel="prefetch" href="/assets/js/23.d80486b4.js"><link rel="prefetch" href="/assets/js/24.d1ded971.js"><link rel="prefetch" href="/assets/js/25.2b5651f2.js"><link rel="prefetch" href="/assets/js/26.be0532f1.js"><link rel="prefetch" href="/assets/js/27.601e9758.js"><link rel="prefetch" href="/assets/js/28.5f3c5013.js"><link rel="prefetch" href="/assets/js/29.b11be3d0.js"><link rel="prefetch" href="/assets/js/3.13e892f5.js"><link rel="prefetch" href="/assets/js/30.b5a85a3d.js"><link rel="prefetch" href="/assets/js/31.656e3cca.js"><link rel="prefetch" href="/assets/js/32.df47284c.js"><link rel="prefetch" href="/assets/js/33.cf2bef7f.js"><link rel="prefetch" href="/assets/js/34.b76a28cc.js"><link rel="prefetch" href="/assets/js/35.4656aa60.js"><link rel="prefetch" href="/assets/js/36.bc0d7be9.js"><link rel="prefetch" href="/assets/js/37.41e22cc1.js"><link rel="prefetch" href="/assets/js/38.9a20d42b.js"><link rel="prefetch" href="/assets/js/39.5d96398a.js"><link rel="prefetch" href="/assets/js/4.5bdb9365.js"><link rel="prefetch" href="/assets/js/40.fb9028aa.js"><link rel="prefetch" href="/assets/js/41.96d148c1.js"><link rel="prefetch" href="/assets/js/42.26c75454.js"><link rel="prefetch" href="/assets/js/43.59ed847d.js"><link rel="prefetch" href="/assets/js/44.4c9bed25.js"><link rel="prefetch" href="/assets/js/45.547c992f.js"><link rel="prefetch" href="/assets/js/46.d63785ae.js"><link rel="prefetch" href="/assets/js/47.34a532a7.js"><link rel="prefetch" href="/assets/js/48.81fda019.js"><link rel="prefetch" href="/assets/js/5.7c68fdb5.js"><link rel="prefetch" href="/assets/js/50.bd461786.js"><link rel="prefetch" href="/assets/js/51.b83fa154.js"><link rel="prefetch" href="/assets/js/52.6880a119.js"><link rel="prefetch" href="/assets/js/53.f60e17c7.js"><link rel="prefetch" href="/assets/js/54.833a4f5c.js"><link rel="prefetch" href="/assets/js/55.ed6a7c66.js"><link rel="prefetch" href="/assets/js/56.c9eef7e1.js"><link rel="prefetch" href="/assets/js/57.abbfb924.js"><link rel="prefetch" href="/assets/js/58.c1df5fda.js"><link rel="prefetch" href="/assets/js/59.1615eb2d.js"><link rel="prefetch" href="/assets/js/6.c8da7ca7.js"><link rel="prefetch" href="/assets/js/60.a1480688.js"><link rel="prefetch" href="/assets/js/61.901ae4d3.js"><link rel="prefetch" href="/assets/js/62.dc705c01.js"><link rel="prefetch" href="/assets/js/63.a3367f7e.js"><link rel="prefetch" href="/assets/js/64.44397e2a.js"><link rel="prefetch" href="/assets/js/65.b6f8a966.js"><link rel="prefetch" href="/assets/js/66.305bd539.js"><link rel="prefetch" href="/assets/js/67.b47bf615.js"><link rel="prefetch" href="/assets/js/68.63565465.js"><link rel="prefetch" href="/assets/js/69.141e956c.js"><link rel="prefetch" href="/assets/js/7.e4c88d0e.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5143d2e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4a844ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">duangdongçš„engineering</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/engineering/" class="nav-link">
  å·¥ç¨‹åŒ–
</a></div><div class="nav-item"><a href="/webpack/" class="nav-link router-link-active">
  Webpack
</a></div><div class="nav-item"><a href="/webpack-explain/" class="nav-link">
  æ·±å…¥æµ…å‡ºWebpack
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  Babel
</a></div><div class="nav-item"><a href="/micro-front/" class="nav-link">
  å¾®å‰ç«¯
</a></div><div class="nav-item"><a href="https://link.aduang.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/engineering/" class="nav-link">
  å·¥ç¨‹åŒ–
</a></div><div class="nav-item"><a href="/webpack/" class="nav-link router-link-active">
  Webpack
</a></div><div class="nav-item"><a href="/webpack-explain/" class="nav-link">
  æ·±å…¥æµ…å‡ºWebpack
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  Babel
</a></div><div class="nav-item"><a href="/micro-front/" class="nav-link">
  å¾®å‰ç«¯
</a></div><div class="nav-item"><a href="https://link.aduang.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/webpack/" aria-current="page" class="sidebar-link">å‰ç«¯å·¥ç¨‹åŒ–</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>1-webpackåŸç†</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/1-webpackåŸç†/Webpackä¸‹çš„HMRæœºåˆ¶åŸç†.html" class="sidebar-link">Webpack ä¸‹çš„ HMR æœºåˆ¶åŸç†: 120 è¡Œä»£ç å¸®ä½ æå®š</a></li><li><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—ä¸€-ä¸€æ–‡åƒé€Webpackæ ¸å¿ƒåŸç†.html" class="sidebar-link">ä¸€æ–‡åƒé€ Webpack æ ¸å¿ƒåŸç†</a></li><li><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—ä¸ƒ-å¦‚ä½•ç¼–å†™loader.html" class="active sidebar-link">Webpack åŸç†ç³»åˆ—ä¸ƒï¼šå¦‚ä½•ç¼–å†™loader</a></li><li><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—ä¹-Tree-Shakingå®ç°åŸç†.html" class="sidebar-link">Webpack åŸç†ç³»åˆ—ä¹ï¼šTree-Shakingå®ç°åŸç†</a></li><li><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—äºŒ-Webpackæ’ä»¶æ¶æ„æ·±åº¦è®²è§£.html" class="sidebar-link">Webpack æ’ä»¶æ¶æ„æ·±åº¦è®²è§£</a></li><li><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—äº”-Webpack-Chunkåˆ†åŒ…è§„åˆ™è¯¦è§£.html" class="sidebar-link">æœ‰ç‚¹éš¾çš„çŸ¥è¯†ç‚¹ï¼š Webpack Chunk åˆ†åŒ…è§„åˆ™è¯¦è§£</a></li><li><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—å…«-äº§ç‰©è½¬è¯‘æ‰“åŒ…é€»è¾‘.html" class="sidebar-link">Webpack åŸç†ç³»åˆ—å…«ï¼šäº§ç‰©è½¬è¯‘æ‰“åŒ…é€»è¾‘</a></li><li><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—å…­-å½»åº•ç†è§£Webpackè¿è¡Œæ—¶.html" class="sidebar-link">Webpack åŸç†ç³»åˆ—å…­ï¼š å½»åº•ç†è§£Webpackè¿è¡Œæ—¶</a></li><li><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—å››-Dependency-Graphæ·±åº¦è§£æ.html" class="sidebar-link">æœ‰ç‚¹éš¾çš„ webpack çŸ¥è¯†ç‚¹ï¼šDependency Graph æ·±åº¦è§£æ</a></li><li><a href="/webpack/1-webpackåŸç†/webpackåŸç†ç³»åˆ—-ä½¿ç”¨ Cache æå‡æ„å»ºæ€§èƒ½.html" class="sidebar-link">Webpack æ€§èƒ½ç³»åˆ—ä¸€: ä½¿ç”¨ Cache æå‡æ„å»ºæ€§èƒ½</a></li><li><a href="/webpack/1-webpackåŸç†/webpackæ–¹æ–¹é¢é¢çš„æ ¸å¿ƒåŸç†æ€»ç»“.html" class="sidebar-link">webpack æ–¹æ–¹é¢é¢çš„æ ¸å¿ƒåŸç†æ€»ç»“</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2-webpackä¼˜åŒ–</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/webpack/Koa2ä¸­ä½¿ç”¨webpackè¿›è¡Œæ‰“åŒ…å‹ç¼©.html" class="sidebar-link">Koa2ä¸­ä½¿ç”¨webpackè¿›è¡Œæ‰“åŒ…å‹ç¼©</a></li><li><a href="/webpack/esbuildä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«.html" class="sidebar-link">esbuild ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«?</a></li><li><a href="/webpack/module-issuerå±æ€§è¯¦è§£.html" class="sidebar-link">ååˆ†é’Ÿç²¾è¿› Webpackï¼šmodule.issuer å±æ€§è¯¦è§£</a></li><li><a href="/webpack/webpack-node.html" class="sidebar-link">Nodeä¸­ä½¿ç”¨webpackæ‰“åŒ…æ—¶å‡ºç°çš„é”™è¯¯å’Œè­¦å‘Š</a></li><li><a href="/webpack/ä¸è¦å†çœ‹loaderåŸç†äº†ï¼Œè‡ªå·±å†™ä¸€ä¸ªå°±ä»€ä¹ˆéƒ½æ˜ç™½äº†.html" class="sidebar-link">ä¸è¦å†çœ‹loaderåŸç†äº†ï¼Œè‡ªå·±å†™ä¸€ä¸ªå°±ä»€ä¹ˆéƒ½æ˜ç™½äº†</a></li><li><a href="/webpack/åˆ†äº«å‡ ä¸ªWebpackå®ç”¨åˆ†æå·¥å…·.html" class="sidebar-link">åˆ†äº«å‡ ä¸ª Webpack å®ç”¨åˆ†æå·¥å…·</a></li><li><a href="/webpack/å¦‚ä½•å¼€å‘VSCode-LSPæœåŠ¡.html" class="sidebar-link">å®ä¾‹è§£æï¼šå¦‚ä½•å¼€å‘ VSCode LSP æœåŠ¡</a></li><li><a href="/webpack/å¦‚ä½•è°ƒè¯•Webpacké—®é¢˜.html" class="sidebar-link">æˆ‘æ˜¯å¦‚ä½•è°ƒè¯• Webpack é—®é¢˜çš„</a></li><li><a href="/webpack/æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨Webpack-Plugin.html" class="sidebar-link">æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨ Webpack Plugin</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-åŸç†ç³»åˆ—ä¸ƒ-å¦‚ä½•ç¼–å†™loader"><a href="#webpack-åŸç†ç³»åˆ—ä¸ƒ-å¦‚ä½•ç¼–å†™loader" class="header-anchor">#</a> Webpack åŸç†ç³»åˆ—ä¸ƒï¼šå¦‚ä½•ç¼–å†™loader</h1> <p>å…³äº Webpack Loaderï¼Œç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šå¾ˆå¤šçš„èµ„æ–™ï¼Œå¾ˆéš¾è®²å‡ºèŠ±æ¥ï¼Œä½†æ˜¯è¦å†™ Webpack çš„ç³»åˆ—åšæ–‡åˆæ²¡åŠæ³•ç»•å¼€è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘é˜…è¯»äº†è¶…è¿‡ 20 ä¸ªå¼€æºé¡¹ç›®ï¼Œå°½é‡å…¨é¢åœ°æ€»ç»“äº†ä¸€äº›ç¼–å†™ Loader æ—¶éœ€è¦äº†è§£çš„çŸ¥è¯†å’ŒæŠ€å·§ã€‚åŒ…å«ï¼š</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/3xDuJ3eicibll65ExluHjiagfEzNZxz4BjzR9QRkibqRD4E95upPjeLWibLkXGPD8k2ydOq6Ibccibn7ViaoegJrjQgQQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¼€å§‹å§ã€‚</p> <h1 id="è®¤è¯†-loader"><a href="#è®¤è¯†-loader" class="header-anchor">#</a> è®¤è¯† Loader</h1> <blockquote><p>â</p> <p>å¦‚æœè¦åšæ€»ç»“çš„è¯ï¼Œæˆ‘è®¤ä¸º Loader æ˜¯ä¸€ä¸ªå¸¦æœ‰å‰¯ä½œç”¨çš„å†…å®¹è½¬è¯‘å™¨ï¼</p> <p>â</p></blockquote> <p>Webpack Loader æœ€æ ¸å¿ƒçš„åªèƒ½æ˜¯å®ç°å†…å®¹è½¬æ¢å™¨ â€”â€” å°†å„å¼å„æ ·çš„èµ„æºè½¬åŒ–ä¸ºæ ‡å‡† JavaScript å†…å®¹æ ¼å¼ï¼Œä¾‹å¦‚ï¼š</p> <ul><li><code>css-loader</code> å°† css è½¬æ¢ä¸º <code>__WEBPACK_DEFAULT_EXPORT__ = &quot;.a{ xxx }&quot;</code> æ ¼å¼</li> <li><code>html-loader</code> å°† html è½¬æ¢ä¸º <code>__WEBPACK_DEFAULT_EXPORT__ = &quot;&lt;!DOCTYPE xxx&quot;</code> æ ¼å¼</li> <li><code>vue-loader</code> æ›´å¤æ‚ä¸€äº›ï¼Œä¼šå°† <code>.vue</code> æ–‡ä»¶è½¬åŒ–ä¸ºå¤šä¸ª JavaScript å‡½æ•°ï¼Œåˆ†åˆ«å¯¹åº” templateã€jsã€cssã€custom block</li></ul> <p>é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦åšè¿™ç§è½¬æ¢å‘¢ï¼Ÿæœ¬è´¨ä¸Šæ˜¯å› ä¸º Webpack åªè®¤è¯†ç¬¦åˆ JavaScript è§„èŒƒçš„æ–‡æœ¬(Webpack 5ä¹‹åå¢åŠ äº†å…¶å®ƒ parser)ï¼šåœ¨æ„å»º(make)é˜¶æ®µï¼Œè§£ææ¨¡å—å†…å®¹æ—¶ä¼šè°ƒç”¨ <code>acorn</code>å°†æ–‡æœ¬è½¬æ¢ä¸º AST å¯¹è±¡ï¼Œè¿›è€Œåˆ†æä»£ç ç»“æ„ï¼Œåˆ†ææ¨¡å—ä¾èµ–ï¼›è¿™ä¸€å¥—é€»è¾‘å¯¹å›¾ç‰‡ã€jsonã€Vue SFCç­‰åœºæ™¯å°±ä¸ work äº†ï¼Œå°±éœ€è¦ Loader ä»‹å…¥å°†èµ„æºè½¬åŒ–æˆ Webpack å¯ä»¥ç†è§£çš„å†…å®¹å½¢æ€ã€‚</p> <blockquote><p>Plugin æ˜¯ Webpack å¦ä¸€å¥—æ‰©å±•æœºåˆ¶ï¼ŒåŠŸèƒ½æ›´å¼ºï¼Œèƒ½å¤Ÿåœ¨å„ä¸ªå¯¹è±¡çš„é’©å­ä¸­æ’å…¥ç‰¹åŒ–å¤„ç†é€»è¾‘ï¼Œå®ƒå¯ä»¥è¦†ç›– Webpack å…¨ç”Ÿå‘½æµç¨‹ï¼Œèƒ½åŠ›ã€çµæ´»æ€§ã€å¤æ‚åº¦éƒ½ä¼šæ¯” Loader å¼ºå¾ˆå¤šï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è®²ã€‚</p></blockquote> <h2 id="loader-åŸºç¡€"><a href="#loader-åŸºç¡€" class="header-anchor">#</a> Loader åŸºç¡€</h2> <p>ä»£ç å±‚é¢ï¼ŒLoader é€šå¸¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = function(source, sourceMap?, data?) {
  // source ä¸º loader çš„è¾“å…¥ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶å†…å®¹ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸Šä¸€ä¸ª loader å¤„ç†ç»“æœ
  return source;
};
</code></pre></div><p>Loader å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºï¼š</p> <ul><li><code>source</code>ï¼šèµ„æºè¾“å…¥ï¼Œå¯¹äºç¬¬ä¸€ä¸ªæ‰§è¡Œçš„ loader ä¸ºèµ„æºæ–‡ä»¶çš„å†…å®¹ï¼›åç»­æ‰§è¡Œçš„ loader åˆ™ä¸ºå‰ä¸€ä¸ª loader çš„æ‰§è¡Œç»“æœ</li> <li><code>sourceMap</code>: å¯é€‰å‚æ•°ï¼Œä»£ç çš„ sourcemap ç»“æ„</li> <li><code>data</code>: å¯é€‰å‚æ•°ï¼Œå…¶å®ƒéœ€è¦åœ¨ Loader é“¾ä¸­ä¼ é€’çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ posthtml/posthtml-loader å°±ä¼šé€šè¿‡è¿™ä¸ªå‚æ•°ä¼ é€’å‚æ•°çš„ AST å¯¹è±¡</li></ul> <p>å…¶ä¸­ <code>source</code> æ˜¯æœ€é‡è¦çš„å‚æ•°ï¼Œå¤§å¤šæ•° Loader è¦åšçš„äº‹æƒ…å°±æ˜¯å°† <code>source</code> è½¬è¯‘ä¸ºå¦ä¸€ç§å½¢å¼çš„ <code>output</code> ï¼Œæ¯”å¦‚ webpack-contrib/raw-loader çš„æ ¸å¿ƒæºç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>//... 
export default function rawLoader(source) {
  // ...

  const json = JSON.stringify(source)
    .replace(/\u2028/g, '\\u2028')
    .replace(/\u2029/g, '\\u2029');

  const esModule =
    typeof options.esModule !== 'undefined' ? options.esModule : true;

  return `${esModule ? 'export default' : 'module.exports ='} ${json};`;
}
</code></pre></div><p>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å°†æ–‡æœ¬å†…å®¹åŒ…è£¹æˆ JavaScript æ¨¡å—ï¼Œä¾‹å¦‚ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// source
I am Tecvan

// output
module.exports = &quot;I am Tecvan&quot;
</code></pre></div><p>ç»è¿‡æ¨¡å—åŒ–åŒ…è£…ä¹‹åï¼Œè¿™æ®µæ–‡æœ¬å†…å®¹è½¬èº«å˜æˆ Webpack å¯ä»¥å¤„ç†çš„èµ„æºæ¨¡å—ï¼Œå…¶å®ƒ module ä¹Ÿå°±èƒ½å¼•ç”¨ã€ä½¿ç”¨å®ƒäº†ã€‚</p> <h2 id="è¿”å›å¤šä¸ªç»“æœ"><a href="#è¿”å›å¤šä¸ªç»“æœ" class="header-anchor">#</a> è¿”å›å¤šä¸ªç»“æœ</h2> <p>ä¸Šä¾‹é€šè¿‡ <code>return</code> è¯­å¥è¿”å›å¤„ç†ç»“æœï¼Œé™¤æ­¤ä¹‹å¤– Loader è¿˜å¯ä»¥ä»¥ <code>callback</code> æ–¹å¼è¿”å›æ›´å¤šä¿¡æ¯ï¼Œä¾›ä¸‹æ¸¸ Loader æˆ–è€… Webpack æœ¬èº«ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ webpack-contrib/eslint-loader ä¸­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>export default function loader(content, map) {
  // ...
  linter.printOutput(linter.lint(content));
  this.callback(null, content, map);
}
</code></pre></div><p>é€šè¿‡ <code>this.callback(null, content, map)</code> è¯­å¥åŒæ—¶è¿”å›è½¬è¯‘åçš„å†…å®¹ä¸ sourcemap å†…å®¹ã€‚<code>callback</code> çš„å®Œæ•´ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>this.callback(
    // å¼‚å¸¸ä¿¡æ¯ï¼ŒLoader æ­£å¸¸è¿è¡Œæ—¶ä¼ é€’ null å€¼å³å¯
    err: Error | null,
    // è½¬è¯‘ç»“æœ
    content: string | Buffer,
    // æºç çš„ sourcemap ä¿¡æ¯
    sourceMap?: SourceMap,
    // ä»»æ„éœ€è¦åœ¨ Loader é—´ä¼ é€’çš„å€¼
    // ç»å¸¸ç”¨æ¥ä¼ é€’ ast å¯¹è±¡ï¼Œé¿å…é‡å¤è§£æ
    data?: any
);
</code></pre></div><h2 id="å¼‚æ­¥å¤„ç†"><a href="#å¼‚æ­¥å¤„ç†" class="header-anchor">#</a> å¼‚æ­¥å¤„ç†</h2> <p>æ¶‰åŠåˆ°å¼‚æ­¥æˆ– CPU å¯†é›†æ“ä½œæ—¶ï¼ŒLoader ä¸­è¿˜å¯ä»¥ä»¥å¼‚æ­¥å½¢å¼è¿”å›å¤„ç†ç»“æœï¼Œä¾‹å¦‚ webpack-contrib/less-loader çš„æ ¸å¿ƒé€»è¾‘ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>import less from &quot;less&quot;;

async function lessLoader(source) {
  // 1. è·å–å¼‚æ­¥å›è°ƒå‡½æ•°
  const callback = this.async();
  // ...

  let result;

  try {
    // 2. è°ƒç”¨less å°†æ¨¡å—å†…å®¹è½¬è¯‘ä¸º css
    result = await (options.implementation || less).render(data, lessOptions);
  } catch (error) {
    // ...
  }

  const { css, imports } = result;

  // ...

  // 3. è½¬è¯‘ç»“æŸï¼Œè¿”å›ç»“æœ
  callback(null, css, map);
}

export default lessLoader;
</code></pre></div><p>åœ¨ less-loader ä¸­ï¼Œé€»è¾‘åˆ†ä¸‰æ­¥ï¼š</p> <ul><li>è°ƒç”¨ <code>this.async</code> è·å–å¼‚æ­¥å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶ Webpack ä¼šå°†è¯¥ Loader æ ‡è®°ä¸ºå¼‚æ­¥åŠ è½½å™¨ï¼Œä¼šæŒ‚èµ·å½“å‰æ‰§è¡Œé˜Ÿåˆ—ç›´åˆ° <code>callback</code> è¢«è§¦å‘</li> <li>è°ƒç”¨ <code>less</code> åº“å°† less èµ„æºè½¬è¯‘ä¸ºæ ‡å‡† css</li> <li>è°ƒç”¨å¼‚æ­¥å›è°ƒ <code>callback</code> è¿”å›å¤„ç†ç»“æœ</li></ul> <p><code>this.async</code> è¿”å›çš„å¼‚æ­¥å›è°ƒå‡½æ•°ç­¾åä¸ä¸Šä¸€èŠ‚ä»‹ç»çš„ <code>this.callback</code> ç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p> <h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="header-anchor">#</a> ç¼“å­˜</h2> <p>Loader ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ‰©å±•æ–¹æ³•ï¼Œä½†åœ¨ Loader ä¸­æ‰§è¡Œçš„å„ç§èµ„æºå†…å®¹è½¬è¯‘æ“ä½œé€šå¸¸éƒ½æ˜¯ CPU å¯†é›†å‹ â€”â€” è¿™æ”¾åœ¨å•çº¿ç¨‹çš„ Node åœºæ™¯ä¸‹å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼›åˆæˆ–è€…å¼‚æ­¥ Loader ä¼šæŒ‚èµ·åç»­çš„åŠ è½½å™¨é˜Ÿåˆ—ç›´åˆ°å¼‚æ­¥ Loader è§¦å‘å›è°ƒï¼Œç¨å¾®ä¸æ³¨æ„å°±å¯èƒ½å¯¼è‡´æ•´ä¸ªåŠ è½½å™¨é“¾æ¡çš„æ‰§è¡Œæ—¶é—´è¿‡é•¿ã€‚</p> <p>ä¸ºæ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ Webpack ä¼šç¼“å­˜ Loader çš„æ‰§è¡Œç»“æœç›´åˆ°èµ„æºæˆ–èµ„æºä¾èµ–å‘ç”Ÿå˜åŒ–ï¼Œå¼€å‘è€…éœ€è¦å¯¹æ­¤æœ‰ä¸ªåŸºæœ¬çš„ç†è§£ï¼Œå¿…è¦æ—¶å¯ä»¥é€šè¿‡ <code>this.cachable</code> æ˜¾å¼å£°æ˜ä¸ä½œç¼“å­˜ï¼Œä¾‹å¦‚ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = function(source) {
  this.cacheable(false);
  // ...
  return output;
};
</code></pre></div><h2 id="ä¸Šä¸‹æ–‡ä¸-side-effect"><a href="#ä¸Šä¸‹æ–‡ä¸-side-effect" class="header-anchor">#</a> ä¸Šä¸‹æ–‡ä¸ Side Effect</h2> <p>é™¤äº†ä½œä¸ºå†…å®¹è½¬æ¢å™¨å¤–ï¼ŒLoader è¿è¡Œè¿‡ç¨‹è¿˜å¯ä»¥é€šè¿‡ä¸€äº›ä¸Šä¸‹æ–‡æ¥å£ï¼Œæœ‰é™åˆ¶åœ°å½±å“ Webpack ç¼–è¯‘è¿‡ç¨‹ï¼Œä»è€Œäº§ç”Ÿå†…å®¹è½¬æ¢ä¹‹å¤–çš„å‰¯ä½œç”¨ã€‚</p> <p>ä¸Šä¸‹æ–‡ä¿¡æ¯å¯é€šè¿‡ <code>this</code> è·å–ï¼Œ<code>this</code> å¯¹è±¡ç”± <code>NormolModule.createLoaderContext</code> å‡½æ•°åœ¨è°ƒç”¨ Loader å‰åˆ›å»ºï¼Œå¸¸ç”¨çš„æ¥å£åŒ…æ‹¬ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const loaderContext = {
    // è·å–å½“å‰ Loader çš„é…ç½®ä¿¡æ¯
    getOptions: schema =&gt; {},
    // æ·»åŠ è­¦å‘Š
    emitWarning: warning =&gt; {},
    // æ·»åŠ é”™è¯¯ä¿¡æ¯ï¼Œæ³¨æ„è¿™ä¸ä¼šä¸­æ–­ Webpack è¿è¡Œ
    emitError: error =&gt; {},
    // è§£æèµ„æºæ–‡ä»¶çš„å…·ä½“è·¯å¾„
    resolve(context, request, callback) {},
    // ç›´æ¥æäº¤æ–‡ä»¶ï¼Œæäº¤çš„æ–‡ä»¶ä¸ä¼šç»è¿‡åç»­çš„chunkã€moduleå¤„ç†ï¼Œç›´æ¥è¾“å‡ºåˆ° fs
    emitFile: (name, content, sourceMap, assetInfo) =&gt; {},
    // æ·»åŠ é¢å¤–çš„ä¾èµ–æ–‡ä»¶
    // watch æ¨¡å¼ä¸‹ï¼Œä¾èµ–æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ä¼šè§¦å‘èµ„æºé‡æ–°ç¼–è¯‘
    addDependency(dep) {},
};
</code></pre></div><p>å…¶ä¸­ï¼Œ<code>addDependency</code>ã€<code>emitFile</code> ã€<code>emitError</code>ã€<code>emitWarning</code> éƒ½ä¼šå¯¹åç»­ç¼–è¯‘æµç¨‹äº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¾‹å¦‚ <code>less-loader</code> ä¸­åŒ…å«è¿™æ ·ä¸€æ®µä»£ç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>  try {
    result = await (options.implementation || less).render(data, lessOptions);
  } catch (error) {
    // ...
  }

  const { css, imports } = result;

  imports.forEach((item) =&gt; {
    // ...
    this.addDependency(path.normalize(item));
  });
</code></pre></div><p>è§£é‡Šä¸€ä¸‹ï¼Œä»£ç ä¸­é¦–å…ˆè°ƒç”¨ <code>less</code> ç¼–è¯‘æ–‡ä»¶å†…å®¹ï¼Œä¹‹åéå†æ‰€æœ‰ <code>import</code> è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¾‹ <code>result.imports</code> æ•°ç»„ï¼Œä¸€ä¸€è°ƒç”¨ <code>this.addDependency</code> å‡½æ•°å°† import åˆ°çš„å…¶å®ƒèµ„æºéƒ½æ³¨å†Œä¸ºä¾èµ–ï¼Œä¹‹åè¿™äº›å…¶å®ƒèµ„æºæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶éƒ½ä¼šè§¦å‘é‡æ–°ç¼–è¯‘ã€‚</p> <h1 id="loader-é“¾å¼è°ƒç”¨"><a href="#loader-é“¾å¼è°ƒç”¨" class="header-anchor">#</a> Loader é“¾å¼è°ƒç”¨</h1> <p>ä½¿ç”¨ä¸Šï¼Œå¯ä»¥ä¸ºæŸç§èµ„æºæ–‡ä»¶é…ç½®å¤šä¸ª Loaderï¼ŒLoader ä¹‹é—´æŒ‰ç…§é…ç½®çš„é¡ºåºä»å‰åˆ°å(pitch)ï¼Œå†ä»ååˆ°å‰ä¾æ¬¡æ‰§è¡Œï¼Œä»è€Œå½¢æˆä¸€å¥—å†…å®¹è½¬è¯‘å·¥ä½œæµï¼Œä¾‹å¦‚å¯¹äºä¸‹é¢çš„é…ç½®ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = {
  module: {
    rules: [
      {
        test: /\.less$/i,
        use: [
          &quot;style-loader&quot;,
          &quot;css-loader&quot;,
          &quot;less-loader&quot;,
        ],
      },
    ],
  },
};
</code></pre></div><p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ less å¤„ç†åœºæ™¯ï¼Œé’ˆå¯¹ <code>.less</code> åç¼€çš„æ–‡ä»¶è®¾å®šäº†ï¼šlessã€cssã€style ä¸‰ä¸ª loader åä½œå¤„ç†èµ„æºæ–‡ä»¶ï¼ŒæŒ‰ç…§å®šä¹‰çš„é¡ºåºï¼ŒWebpack è§£æ less æ–‡ä»¶å†…å®¹åå…ˆä¼ å…¥ less-loaderï¼›less-loader è¿”å›çš„ç»“æœå†ä¼ å…¥ css-loader å¤„ç†ï¼›css-loader çš„ç»“æœå†ä¼ å…¥ style-loaderï¼›æœ€ç»ˆä»¥ style-loader çš„å¤„ç†ç»“æœä¸ºå‡†ï¼Œæµç¨‹ç®€åŒ–åå¦‚ï¼š</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œä¸‰ä¸ª Loader åˆ†åˆ«èµ·å¦‚ä¸‹ä½œç”¨ï¼š</p> <ul><li><code>less-loader</code>ï¼šå®ç° less =&gt; css çš„è½¬æ¢ï¼Œè¾“å‡º css å†…å®¹ï¼Œæ— æ³•è¢«ç›´æ¥åº”ç”¨åœ¨ Webpack ä½“ç³»ä¸‹</li> <li><code>css-loader</code>ï¼šå°† css å†…å®¹åŒ…è£…æˆç±»ä¼¼ <code>module.exports = &quot;${css}&quot;</code> çš„å†…å®¹ï¼ŒåŒ…è£…åçš„å†…å®¹ç¬¦åˆ JavaScript è¯­æ³•</li> <li><code>style-loader</code>ï¼šåšçš„äº‹æƒ…éå¸¸ç®€å•ï¼Œå°±æ˜¯å°† css æ¨¡å—åŒ…è¿› require è¯­å¥ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è°ƒç”¨ injectStyle ç­‰å‡½æ•°å°†å†…å®¹æ³¨å…¥åˆ°é¡µé¢çš„ style æ ‡ç­¾</li></ul> <p>ä¸‰ä¸ª Loader åˆ†åˆ«å®Œæˆå†…å®¹è½¬åŒ–å·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œå½¢æˆä»å³åˆ°å·¦çš„è°ƒç”¨é“¾æ¡ã€‚é“¾å¼è°ƒç”¨è¿™ç§è®¾è®¡æœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œä¸€æ˜¯ä¿æŒå•ä¸ª Loader çš„å•ä¸€èŒè´£ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½ä»£ç çš„å¤æ‚åº¦ï¼›äºŒæ˜¯ç»†ç²’åº¦çš„åŠŸèƒ½èƒ½å¤Ÿè¢«ç»„è£…æˆå¤æ‚è€Œçµæ´»çš„å¤„ç†é“¾æ¡ï¼Œæå‡å•ä¸ª Loader çš„å¯å¤ç”¨æ€§ã€‚</p> <p>ä¸è¿‡ï¼Œè¿™åªæ˜¯é“¾å¼è°ƒç”¨çš„ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œé¢æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p> <ul><li>Loader é“¾æ¡ä¸€æ—¦å¯åŠ¨ä¹‹åï¼Œéœ€è¦æ‰€æœ‰ Loader éƒ½æ‰§è¡Œå®Œæ¯•æ‰ä¼šç»“æŸï¼Œæ²¡æœ‰ä¸­æ–­çš„æœºä¼š â€”â€” é™¤éæ˜¾å¼æŠ›å‡ºå¼‚å¸¸</li> <li>æŸäº›åœºæ™¯ä¸‹å¹¶ä¸éœ€è¦å…³å¿ƒèµ„æºçš„å…·ä½“å†…å®¹ï¼Œä½† Loader éœ€è¦åœ¨ source å†…å®¹è¢«è¯»å–å‡ºæ¥ä¹‹åæ‰ä¼šæ‰§è¡Œ</li></ul> <p>ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼ŒWebpack åœ¨ loader åŸºç¡€ä¸Šå åŠ äº† <code>pitch</code> çš„æ¦‚å¿µã€‚</p> <h1 id="loader-pitch"><a href="#loader-pitch" class="header-anchor">#</a> Loader Pitch</h1> <p>ç½‘ç»œä¸Šå…³äº Loader çš„æ–‡ç« å·²ç»æœ‰éå¸¸éå¸¸å¤šï¼Œä½†å¤šæ•°å¹¶æ²¡æœ‰å¯¹ <code>pitch</code> è¿™ä¸€é‡è¦ç‰¹æ€§åšè¶³å¤Ÿæ·±å…¥çš„ä»‹ç»ï¼Œæ²¡æœ‰è®²æ¸…æ¥šä¸ºä»€ä¹ˆè¦è®¾è®¡ pitch è¿™ä¸ªåŠŸèƒ½ï¼Œpitch æœ‰å“ªäº›å¸¸è§ç”¨ä¾‹ç­‰ã€‚</p> <p>åœ¨è¿™ä¸€èŠ‚ï¼Œæˆ‘ä¼šä» whatã€howã€why ä¸‰ä¸ªç»´åº¦å±•å¼€èŠèŠ loader pitch è¿™ä¸€ç‰¹æ€§ã€‚</p> <h2 id="ä»€ä¹ˆæ˜¯-pitch"><a href="#ä»€ä¹ˆæ˜¯-pitch" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ pitch</h2> <p>Webpack å…è®¸åœ¨è¿™ä¸ªå‡½æ•°ä¸ŠæŒ‚è½½åä¸º <code>pitch</code> çš„å‡½æ•°ï¼Œè¿è¡Œæ—¶ pitch ä¼šæ¯” Loader æœ¬èº«æ›´æ—©æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const loader = function (source){
    console.log('åæ‰§è¡Œ')
    return source;
}

loader.pitch = function(requestString) {
    console.log('å…ˆæ‰§è¡Œ')
}

module.exports = loader
</code></pre></div><p>Pitch å‡½æ•°çš„å®Œæ•´ç­¾åï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function pitch(
    remainingRequest: string, previousRequest: string, data = {}
): void {
}
</code></pre></div><p>åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼š</p> <ul><li><code>remainingRequest</code> : å½“å‰ loader ä¹‹åçš„èµ„æºè¯·æ±‚å­—ç¬¦ä¸²</li> <li><code>previousRequest</code> : åœ¨æ‰§è¡Œå½“å‰ loader ä¹‹å‰ç»å†è¿‡çš„ loader åˆ—è¡¨</li> <li><code>data</code> : ä¸ Loader å‡½æ•°çš„ <code>data</code> ç›¸åŒï¼Œç”¨äºä¼ é€’éœ€è¦åœ¨ Loader ä¼ æ’­çš„ä¿¡æ¯</li></ul> <p>è¿™äº›å‚æ•°ä¸å¤æ‚ï¼Œä½†ä¸ requestString ç´§å¯†ç›¸å…³ï¼Œæˆ‘ä»¬çœ‹ä¸ªä¾‹å­åŠ æ·±äº†è§£ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = {
  module: {
    rules: [
      {
        test: /\.less$/i,
        use: [
          &quot;style-loader&quot;, &quot;css-loader&quot;, &quot;less-loader&quot;
        ],
      },
    ],
  },
};
</code></pre></div><p><code>css-loader.pitch</code> ä¸­æ‹¿åˆ°çš„å‚æ•°ä¾æ¬¡ä¸ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// css-loader ä¹‹åçš„ loader åˆ—è¡¨åŠèµ„æºè·¯å¾„
remainingRequest = less-loader!./xxx.less
// css-loader ä¹‹å‰çš„ loader åˆ—è¡¨
previousRequest = style-loader
// é»˜è®¤å€¼
data = {}
</code></pre></div><h2 id="è°ƒåº¦é€»è¾‘"><a href="#è°ƒåº¦é€»è¾‘" class="header-anchor">#</a> è°ƒåº¦é€»è¾‘</h2> <p>Pitch ç¿»è¯‘æˆä¸­æ–‡æ˜¯<strong>æŠ›ã€çƒåœºã€åŠ›åº¦ã€äº‹ç‰©æœ€é«˜ç‚¹</strong>ç­‰ï¼Œæˆ‘è§‰å¾— pitch ç‰¹æ€§ä¹‹æ‰€ä»¥è¢«å¿½ç•¥å®Œå…¨æ˜¯è¿™ä¸ªåå­—çš„é”…ï¼Œå®ƒèƒŒåæŠ˜å°„çš„æ˜¯ä¸€æ•´å¥— Loader è¢«æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µã€‚</p> <p>å®ç°ä¸Šï¼ŒLoader é“¾æ¡æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸‰ä¸ªé˜¶æ®µï¼špitchã€è§£æèµ„æºã€æ‰§è¡Œï¼Œè®¾è®¡ä¸Šä¸ DOM çš„äº‹ä»¶æ¨¡å‹éå¸¸ç›¸ä¼¼ï¼Œpitch å¯¹åº”åˆ°æ•è·é˜¶æ®µï¼›æ‰§è¡Œå¯¹åº”åˆ°å†’æ³¡é˜¶æ®µï¼›è€Œä¸¤ä¸ªé˜¶æ®µä¹‹é—´ Webpack ä¼šæ‰§è¡Œèµ„æºå†…å®¹çš„è¯»å–ã€è§£ææ“ä½œï¼Œå¯¹åº” DOM äº‹ä»¶æ¨¡å‹çš„ AT_TARGET é˜¶æ®µï¼š</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p><code>pitch</code> é˜¶æ®µæŒ‰é…ç½®é¡ºåºä»å·¦åˆ°å³é€ä¸ªæ‰§è¡Œ <code>loader.pitch</code> å‡½æ•°(å¦‚æœæœ‰çš„è¯)ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ <code>pitch</code> è¿”å›ä»»æ„å€¼ä¸­æ–­åç»­çš„é“¾è·¯çš„æ‰§è¡Œï¼š</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾è®¡ pitch è¿™ä¸€ç‰¹æ€§å‘¢ï¼Ÿåœ¨åˆ†æäº† style-loaderã€vue-loaderã€to-string-loader ç­‰å¼€æºé¡¹ç›®ä¹‹åï¼Œæˆ‘ä¸ªäººæ€»ç»“å‡ºä¸¤ä¸ªå­—ï¼š<strong>ã€Œé˜»æ–­ã€</strong>ï¼</p> <h2 id="ç¤ºä¾‹-style-loader"><a href="#ç¤ºä¾‹-style-loader" class="header-anchor">#</a> ç¤ºä¾‹ï¼šstyle-loader</h2> <p>å…ˆå›é¡¾ä¸€ä¸‹å‰é¢æåˆ°è¿‡çš„ less åŠ è½½é“¾æ¡ï¼š</p> <ul><li><code>less-loader</code> ï¼šå°† less è§„æ ¼çš„å†…å®¹è½¬æ¢ä¸ºæ ‡å‡† css</li> <li><code>css-loader</code> ï¼šå°† css å†…å®¹åŒ…è£¹ä¸º JavaScript æ¨¡å—</li> <li><code>style-loader</code> ï¼šå°† JavaScript æ¨¡å—çš„å¯¼å‡ºç»“æœä»¥ <code>link</code> ã€<code>style</code> æ ‡ç­¾ç­‰æ–¹å¼æŒ‚è½½åˆ° html ä¸­ï¼Œè®© css ä»£ç èƒ½å¤Ÿæ­£ç¡®è¿è¡Œåœ¨æµè§ˆå™¨ä¸Š</li></ul> <p>å®é™…ä¸Šï¼Œ <code>style-loader</code> åªæ˜¯è´Ÿè´£è®© css èƒ½å¤Ÿåœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹è·‘èµ·æ¥ï¼Œæœ¬è´¨ä¸Šå¹¶ä¸éœ€è¦å…³å¿ƒå…·ä½“å†…å®¹ï¼Œå¾ˆé€‚åˆç”¨ pitch æ¥å¤„ç†ï¼Œæ ¸å¿ƒä»£ç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// ...
// Loader æœ¬èº«ä¸ä½œä»»ä½•å¤„ç†
const loaderApi = () =&gt; {};

// pitch ä¸­æ ¹æ®å‚æ•°æ‹¼æ¥æ¨¡å—ä»£ç 
loaderApi.pitch = function loader(remainingRequest) {
  //...

  switch (injectType) {
    case 'linkTag': {
      return `${
        esModule
          ? `...`
          // å¼•å…¥ runtime æ¨¡å—
          : `var api = require(${loaderUtils.stringifyRequest(
              this,
              `!${path.join(__dirname, 'runtime/injectStylesIntoLinkTag.js')}`
            )});
            // å¼•å…¥ css æ¨¡å—
            var content = require(${loaderUtils.stringifyRequest(
              this,
              `!!${remainingRequest}`
            )});

            content = content.__esModule ? content.default : content;`
      } // ...`;
    }

    case 'lazyStyleTag':
    case 'lazySingletonStyleTag': {
        //...
    }

    case 'styleTag':
    case 'singletonStyleTag':
    default: {
        // ...
    }
  }
};

export default loaderApi;
</code></pre></div><p>å…³é”®ç‚¹ï¼š</p> <ul><li><p><code>loaderApi</code> ä¸ºç©ºå‡½æ•°ï¼Œä¸åšä»»ä½•å¤„ç†</p></li> <li><p><code>loaderApi.pitch</code> ä¸­æ‹¼æ¥ç»“æœï¼Œå¯¼å‡ºçš„ä»£ç åŒ…å«ï¼š</p></li> <li><ul><li>å¼•å…¥è¿è¡Œæ—¶æ¨¡å— <code>runtime/injectStylesIntoLinkTag.js</code></li> <li>å¤ç”¨ <code>remainingRequest</code> å‚æ•°ï¼Œé‡æ–°å¼•å…¥ css æ–‡ä»¶</li></ul></li></ul> <p>è¿è¡Œç»“æœå¤§è‡´å¦‚ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var api = require('xxx/style-loader/lib/runtime/injectStylesIntoLinkTag.js')
var content = require('!!css-loader!less-loader!./xxx.less');
</code></pre></div><p>æ³¨æ„äº†ï¼Œåˆ°è¿™é‡Œ style-loader çš„ pitch å‡½æ•°è¿”å›è¿™ä¸€æ®µå†…å®¹ï¼Œåç»­çš„ Loader å°±ä¸ä¼šç»§ç»­æ‰§è¡Œï¼Œå½“å‰è°ƒç”¨é“¾æ¡ä¸­æ–­äº†ï¼š</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>ä¹‹åï¼ŒWebpack ç»§ç»­è§£æã€æ„å»º style-loader è¿”å›çš„ç»“æœï¼Œé‡åˆ° inline loader è¯­å¥ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>var content = require('!!css-loader!less-loader!./xxx.less');
</code></pre></div><p>æ‰€ä»¥ä» Webpack çš„è§’åº¦çœ‹ï¼Œå®é™…ä¸Šå¯¹åŒä¸€ä¸ªæ–‡ä»¶è°ƒç”¨äº†ä¸¤æ¬¡ loader é“¾ï¼Œç¬¬ä¸€æ¬¡åœ¨ style-loader çš„ pitch ä¸­æ–­ï¼Œç¬¬äºŒæ¬¡æ ¹æ® inline loader çš„å†…å®¹è·³è¿‡äº† style-loaderã€‚</p> <p>ç›¸ä¼¼çš„æŠ€å·§åœ¨å…¶å®ƒä»“åº“ä¹Ÿæœ‰å‡ºç°ï¼Œæ¯”å¦‚ vue-loaderï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰å‘åœ¨ ByteFE å…¬ä¼—å·ä¸Šçš„æ–‡ç« ã€Š<a href="https://mp.weixin.qq.com/s?__biz=Mzg2ODQ1OTExOA==&amp;mid=2247487730&amp;idx=1&amp;sn=0678ba3acebfd67ce4e31128d313c89b&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">Webpack æ¡ˆä¾‹ â€”â€”vue-loader åŸç†åˆ†æ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‹ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®²äº†ã€‚</p> <h1 id="è¿›é˜¶æŠ€å·§"><a href="#è¿›é˜¶æŠ€å·§" class="header-anchor">#</a> è¿›é˜¶æŠ€å·§</h1> <h2 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="header-anchor">#</a> å¼€å‘å·¥å…·</h2> <p>Webpack ä¸º Loader å¼€å‘è€…æä¾›äº†ä¸¤ä¸ªå®ç”¨å·¥å…·ï¼Œåœ¨è¯¸å¤šå¼€æº Loader ä¸­å‡ºç°é¢‘ç‡æé«˜ï¼š</p> <ul><li>webpack/loader-utilsï¼šæä¾›äº†ä¸€ç³»åˆ—è¯¸å¦‚è¯»å–é…ç½®ã€requestString åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€è®¡ç®— hash å€¼ä¹‹ç±»çš„å·¥å…·å‡½æ•°</li> <li>webpack/schema-utilsï¼šå‚æ•°æ ¡éªŒå·¥å…·</li></ul> <p>è¿™äº›å·¥å…·çš„å…·ä½“æ¥å£åœ¨ç›¸åº”çš„ readme ä¸Šå·²ç»æœ‰æ˜ç¡®çš„è¯´æ˜ï¼Œä¸èµ˜è¿°ï¼Œè¿™é‡Œæ€»ç»“ä¸€äº›ç¼–å†™ Loader æ—¶ç»å¸¸ç”¨åˆ°çš„æ ·ä¾‹ï¼šå¦‚ä½•è·å–å¹¶æ ¡éªŒç”¨æˆ·é…ç½®ï¼›å¦‚ä½•æ‹¼æ¥è¾“å‡ºæ–‡ä»¶åã€‚</p> <h3 id="è·å–å¹¶æ ¡éªŒé…ç½®"><a href="#è·å–å¹¶æ ¡éªŒé…ç½®" class="header-anchor">#</a> è·å–å¹¶æ ¡éªŒé…ç½®</h3> <p>Loader é€šå¸¸éƒ½æä¾›äº†ä¸€äº›é…ç½®é¡¹ï¼Œä¾›å¼€å‘è€…å®šåˆ¶è¿è¡Œè¡Œä¸ºï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ Webpack é…ç½®æ–‡ä»¶çš„ <code>use.options</code> å±æ€§è®¾å®šé…ç½®ï¼Œä¾‹å¦‚ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = {
  module: {
    rules: [{
      test: /\.less$/i,
      use: [
        {
          loader: &quot;less-loader&quot;,
          options: {
            cacheDirectory: false
          }
        },
      ],
    }],
  },
};
</code></pre></div><p>åœ¨ Loader å†…éƒ¨ï¼Œéœ€è¦ä½¿ç”¨ <code>loader-utils</code> åº“çš„ <code>getOptions</code> å‡½æ•°è·å–ç”¨æˆ·é…ç½®ï¼Œç”¨ <code>schema-utils</code> åº“çš„ <code>validate</code> å‡½æ•°æ ¡éªŒå‚æ•°åˆæ³•æ€§ï¼Œä¾‹å¦‚ css-loaderï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// css-loader/src/index.js
import { getOptions } from &quot;loader-utils&quot;;
import { validate } from &quot;schema-utils&quot;;
import schema from &quot;./options.json&quot;;


export default async function loader(content, map, meta) {
  const rawOptions = getOptions(this);

  validate(schema, rawOptions, {
    name: &quot;CSS Loader&quot;,
    baseDataPath: &quot;options&quot;,
  });
  // ...
}
</code></pre></div><p>ä½¿ç”¨ <code>schema-utils</code> åšæ ¡éªŒæ—¶éœ€è¦æå‰å£°æ˜é…ç½®æ¨¡æ¿ï¼Œé€šå¸¸ä¼šå¤„ç†æˆä¸€ä¸ªé¢å¤–çš„ json æ–‡ä»¶ï¼Œä¾‹å¦‚ä¸Šä¾‹ä¸­çš„ <code>&quot;./options.json&quot;</code>ã€‚</p> <h3 id="æ‹¼æ¥è¾“å‡ºæ–‡ä»¶å"><a href="#æ‹¼æ¥è¾“å‡ºæ–‡ä»¶å" class="header-anchor">#</a> æ‹¼æ¥è¾“å‡ºæ–‡ä»¶å</h3> <p>Webpack æ”¯æŒä»¥ç±»ä¼¼ <code>[path]/[name]-[hash].js</code> æ–¹å¼è®¾å®š <code>output.filename</code>å³è¾“å‡ºæ–‡ä»¶çš„å‘½åï¼Œè¿™ä¸€å±‚è§„åˆ™é€šå¸¸ä¸éœ€è¦å…³æ³¨ï¼Œä½†æŸäº›åœºæ™¯ä¾‹å¦‚ webpack-contrib/file-loader éœ€è¦æ ¹æ® asset çš„æ–‡ä»¶åæ‹¼æ¥ç»“æœã€‚</p> <p><code>file-loader</code> æ”¯æŒåœ¨ JS æ¨¡å—ä¸­å¼•å…¥è¯¸å¦‚ pngã€jpgã€svg ç­‰æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶å†™å‡ºåˆ°è¾“å‡ºç›®å½•ï¼Œè¿™é‡Œé¢æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå‡å¦‚æ–‡ä»¶å« <code>a.jpg</code> ï¼Œç»è¿‡ Webpack å¤„ç†åè¾“å‡ºä¸º <code>[hash].jpg</code> ï¼Œæ€ä¹ˆå¯¹åº”ä¸Šå‘¢ï¼Ÿæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ <code>loader-utils</code> æä¾›çš„ <code>interpolateName</code> åœ¨ <code>file-loader</code> ä¸­è·å–èµ„æºå†™å‡ºçš„è·¯å¾„åŠåç§°ï¼Œæºç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>import { getOptions, interpolateName } from 'loader-utils';

export default function loader(content) {
  const context = options.context || this.rootContext;
  const name = options.name || '[contenthash].[ext]';

  // æ‹¼æ¥æœ€ç»ˆè¾“å‡ºçš„åç§°
  const url = interpolateName(this, name, {
    context,
    content,
    regExp: options.regExp,
  });

  let outputPath = url;
  // ...

  let publicPath = `__webpack_public_path__ + ${JSON.stringify(outputPath)}`;
  // ...

  if (typeof options.emitFile === 'undefined' || options.emitFile) {
    // ...

    // æäº¤ã€å†™å‡ºæ–‡ä»¶
    this.emitFile(outputPath, content, null, assetInfo);
  }
  // ...

  const esModule =
    typeof options.esModule !== 'undefined' ? options.esModule : true;

  // è¿”å›æ¨¡å—åŒ–å†…å®¹
  return `${esModule ? 'export default' : 'module.exports ='} ${publicPath};`;
}

export const raw = true;
</code></pre></div><p>ä»£ç çš„æ ¸å¿ƒé€»è¾‘ï¼š</p> <ol><li>æ ¹æ® Loader é…ç½®ï¼Œè°ƒç”¨ <code>interpolateName</code> æ–¹æ³•æ‹¼æ¥ç›®æ ‡æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</li> <li>è°ƒç”¨ä¸Šä¸‹æ–‡ <code>this.emitFile</code> æ¥å£ï¼Œå†™å‡ºæ–‡ä»¶</li> <li>è¿”å› <code>module.exports = ${publicPath}</code> ï¼Œå…¶å®ƒæ¨¡å—å¯ä»¥å¼•ç”¨åˆ°è¯¥æ–‡ä»¶è·¯å¾„</li></ol> <p>é™¤ file-loader å¤–ï¼Œcss-loaderã€eslint-loader éƒ½æœ‰ç”¨åˆ°è¯¥æ¥å£ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦è¯·è‡ªè¡Œå‰å¾€æŸ¥é˜…æºç ã€‚</p> <h2 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="header-anchor">#</a> å•å…ƒæµ‹è¯•</h2> <p>åœ¨ Loader ä¸­ç¼–å†™å•å…ƒæµ‹è¯•æ”¶ç›Šéå¸¸é«˜ï¼Œä¸€æ–¹é¢å¯¹å¼€å‘è€…æ¥è¯´ä¸ç”¨å»æ€ä¹ˆå†™ demoï¼Œæ€ä¹ˆæ­å»ºæµ‹è¯•ç¯å¢ƒï¼›ä¸€æ–¹é¢å¯¹äºæœ€ç»ˆç”¨æˆ·æ¥è¯´ï¼Œå¸¦æœ‰ä¸€å®šæµ‹è¯•è¦†ç›–ç‡çš„é¡¹ç›®é€šå¸¸æ„å‘³ç€æ›´é«˜ã€æ›´ç¨³å®šçš„è´¨é‡ã€‚</p> <p>é˜…è¯»äº†è¶…è¿‡ 20 ä¸ªå¼€æºé¡¹ç›®åï¼Œæˆ‘æ€»ç»“äº†ä¸€å¥— Webpack Loader åœºæ™¯ä¸‹å¸¸ç”¨çš„å•å…ƒæµ‹è¯•æµç¨‹ï¼Œä»¥ Jest Â· ğŸƒ Delightful JavaScript Testing ä¸ºä¾‹ï¼š</p> <ol><li>åˆ›å»ºåœ¨ Webpack å®ä¾‹ï¼Œå¹¶è¿è¡Œ Loader</li> <li>è·å– Loader æ‰§è¡Œç»“æœï¼Œæ¯”å¯¹ã€åˆ†æåˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸ</li> <li>åˆ¤æ–­æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦å‡ºé”™</li></ol> <h3 id="å¦‚ä½•è¿è¡Œ-loader"><a href="#å¦‚ä½•è¿è¡Œ-loader" class="header-anchor">#</a> å¦‚ä½•è¿è¡Œ Loader</h3> <p>æœ‰ä¸¤ç§åŠæ³•ï¼Œä¸€æ˜¯åœ¨ node ç¯å¢ƒä¸‹è¿è¡Œè°ƒç”¨ Webpack æ¥å£ï¼Œç”¨ä»£ç è€Œéå‘½ä»¤è¡Œæ‰§è¡Œç¼–è¯‘ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œä¾‹å¦‚ vue-loaderã€stylus-loaderã€babel-loader ç­‰ï¼Œä¼˜ç‚¹çš„è¿è¡Œæ•ˆæœæœ€æ¥è¿‘æœ€ç»ˆç”¨æˆ·ï¼Œç¼ºç‚¹æ˜¯è¿è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½(å¯ä»¥å¿½ç•¥)ã€‚</p> <p>ä»¥ posthtml/posthtml-loader ä¸ºä¾‹ï¼Œå®ƒä¼šåœ¨å¯åŠ¨æµ‹è¯•ä¹‹å‰åˆ›å»ºå¹¶è¿è¡Œ Webpack å®ä¾‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// posthtml-loader/test/helpers/compiler.js æ–‡ä»¶
module.exports = function (fixture, config, options) {
  config = { /*...*/ }

  options = Object.assign({ output: false }, options)

  // åˆ›å»º Webpack å®ä¾‹
  const compiler = webpack(config)

  // ä»¥ MemoryFS æ–¹å¼è¾“å‡ºæ„å»ºç»“æœï¼Œé¿å…å†™ç£ç›˜
  if (!options.output) compiler.outputFileSystem = new MemoryFS()

  // æ‰§è¡Œï¼Œå¹¶ä»¥ promise æ–¹å¼è¿”å›ç»“æœ
  return new Promise((resolve, reject) =&gt; compiler.run((err, stats) =&gt; {
    if (err) reject(err)
    // å¼‚æ­¥è¿”å›æ‰§è¡Œç»“æœ
    resolve(stats)
  }))
}
</code></pre></div><blockquote><p>å°æŠ€å·§ï¼šå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œç”¨ <code>compiler.outputFileSystem = new MemoryFS()</code>è¯­å¥å°† Webpack è®¾å®šæˆè¾“å‡ºåˆ°å†…å­˜ï¼Œèƒ½é¿å…å†™ç›˜æ“ä½œï¼Œæå‡ç¼–è¯‘é€Ÿåº¦ã€‚</p></blockquote> <p>å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯ç¼–å†™ä¸€ç³»åˆ— mock æ–¹æ³•ï¼Œæ­å»ºèµ·ä¸€ä¸ªæ¨¡æ‹Ÿçš„ Webpack è¿è¡Œç¯å¢ƒï¼Œä¾‹å¦‚ emaphp/underscore-template-loader ï¼Œä¼˜ç‚¹çš„è¿è¡Œé€Ÿåº¦æ›´å¿«ï¼Œç¼ºç‚¹æ˜¯å¼€å‘å·¥ä½œé‡å¤§é€šç”¨æ€§ä½ï¼Œäº†è§£äº†è§£å³å¯ã€‚</p> <h3 id="æ¯”å¯¹ç»“æœ"><a href="#æ¯”å¯¹ç»“æœ" class="header-anchor">#</a> æ¯”å¯¹ç»“æœ</h3> <p>ä¸Šä¾‹è¿è¡Œç»“æŸä¹‹åä¼šä»¥ <code>resolve(stats)</code> æ–¹å¼è¿”å›æ‰§è¡Œç»“æœï¼Œ<code>stats</code> å¯¹è±¡ä¸­å‡ ä¹åŒ…å«äº†ç¼–è¯‘è¿‡ç¨‹æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬è€—æ—¶ã€äº§ç‰©ã€æ¨¡å—ã€chunksã€errorsã€warnings ç­‰ç­‰ï¼Œæˆ‘åœ¨ä¹‹å‰çš„æ–‡ç«  <a href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYwMjcxMA==&amp;mid=2247484005&amp;idx=1&amp;sn=ae3e478259a50c54e0282b2efbc28c3f&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">åˆ†äº«å‡ ä¸ª Webpack å®ç”¨åˆ†æå·¥å…·<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å¯¹æ­¤å·²ç»åšäº†è¾ƒæ·±å…¥çš„ä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‰å¾€é˜…è¯»ã€‚</p> <p>åœ¨æµ‹è¯•åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä» <code>stats</code> å¯¹è±¡ä¸­è¯»å–ç¼–è¯‘æœ€ç»ˆè¾“å‡ºçš„äº§ç‰©ï¼Œä¾‹å¦‚ style-loader çš„å®ç°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// style-loader/src/test/helpers/readAsset.js æ–‡ä»¶
function readAsset(compiler, stats, assets) =&gt; {
  const usedFs = compiler.outputFileSystem
  const outputPath = stats.compilation.outputOptions.path
  const queryStringIdx = targetFile.indexOf('?')

  if (queryStringIdx &gt;= 0) {
    // è§£æå‡ºè¾“å‡ºæ–‡ä»¶è·¯å¾„
    asset = asset.substr(0, queryStringIdx)
  }

  // è¯»æ–‡ä»¶å†…å®¹
  return usedFs.readFileSync(path.join(outputPath, targetFile)).toString()
}
</code></pre></div><p>è§£é‡Šä¸€ä¸‹ï¼Œè¿™æ®µä»£ç é¦–å…ˆè®¡ç®— asset è¾“å‡ºçš„æ–‡ä»¶è·¯å¾„ï¼Œä¹‹åè°ƒç”¨ outputFileSystem çš„ <code>readFile</code> æ–¹æ³•è¯»å–æ–‡ä»¶å†…å®¹ã€‚</p> <p>æ¥ä¸‹æ¥ï¼Œæœ‰ä¸¤ç§åˆ†æå†…å®¹çš„æ–¹æ³•ï¼š</p> <ul><li>è°ƒç”¨ Jest çš„ <code>expect(xxx).toMatchSnapshot()</code> æ–­è¨€åˆ¤æ–­å½“å‰è¿è¡Œç»“æœæ˜¯å¦ä¸ä¹‹å‰çš„è¿è¡Œç»“æœä¸€è‡´ï¼Œä»è€Œç¡®ä¿å¤šæ¬¡ä¿®æ”¹çš„ç»“æœä¸€è‡´æ€§ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å¤§é‡ç”¨äº†è¿™ç§æ–¹æ³•</li> <li>è§£è¯»èµ„æºå†…å®¹ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œä¾‹å¦‚ less-loader çš„å•å…ƒæµ‹è¯•ä¸­ä¼šå¯¹åŒä¸€ä»½ä»£ç è·‘ä¸¤æ¬¡ less ç¼–è¯‘ï¼Œä¸€æ¬¡ç”± Webpack æ‰§è¡Œï¼Œä¸€æ¬¡ç›´æ¥è°ƒç”¨ <code>less</code> åº“ï¼Œä¹‹ååˆ†æä¸¤æ¬¡è¿è¡Œç»“æœæ˜¯å¦ç›¸åŒ</li></ul> <p>å¯¹æ­¤æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¼ºçƒˆå»ºè®®çœ‹çœ‹ <code>less-loader</code> çš„ test ç›®å½•ã€‚</p> <h3 id="å¼‚å¸¸åˆ¤æ–­"><a href="#å¼‚å¸¸åˆ¤æ–­" class="header-anchor">#</a> å¼‚å¸¸åˆ¤æ–­</h3> <p>æœ€åï¼Œè¿˜éœ€è¦åˆ¤æ–­ç¼–è¯‘è¿‡ç¨‹æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼ŒåŒæ ·å¯ä»¥ä» <code>stats</code> å¯¹è±¡è§£æï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>export default getErrors = (stats) =&gt; {
  const errors = stats.compilation.errors.sort()
  return errors.map(
    e =&gt; e.toString()
  )
}
</code></pre></div><p>å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å¸Œæœ›ç¼–è¯‘æ²¡æœ‰é”™è¯¯ï¼Œæ­¤æ—¶åªè¦åˆ¤æ–­ç»“æœæ•°ç»„æ˜¯å¦ä¸ºç©ºå³å¯ã€‚æŸäº›æƒ…å†µä¸‹å¯èƒ½éœ€è¦åˆ¤æ–­æ˜¯å¦æŠ›å‡ºç‰¹å®šå¼‚å¸¸ï¼Œæ­¤æ—¶å¯ä»¥ <code>expect(xxx).toMatchSnapshot()</code> æ–­è¨€ï¼Œç”¨å¿«ç…§å¯¹æ¯”æ›´æ–°å‰åçš„ç»“æœã€‚</p> <h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="header-anchor">#</a> è°ƒè¯•</h2> <p>å¼€å‘ Loader çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›å°æŠ€å·§èƒ½å¤Ÿæå‡è°ƒè¯•æ•ˆç‡ï¼ŒåŒ…æ‹¬ï¼š</p> <ul><li>ä½¿ç”¨ ndb å·¥å…·å®ç°æ–­ç‚¹è°ƒè¯•</li> <li>ä½¿ç”¨ <code>npm link</code> å°† Loader æ¨¡å—é“¾æ¥åˆ°æµ‹è¯•é¡¹ç›®</li> <li>ä½¿ç”¨ <code>resolveLoader</code> é…ç½®é¡¹å°† Loader æ‰€åœ¨çš„ç›®å½•åŠ å…¥åˆ°æµ‹è¯•é¡¹ç›®ä¸­ï¼Œå¦‚ï¼š</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// webpack.config.js
module.exports = {
  resolveLoader:{
    modules: ['node_modules','./loaders/'],
  }
}
</code></pre></div><h1 id="æ— å…³ç´§è¦æ€»ç»“"><a href="#æ— å…³ç´§è¦æ€»ç»“" class="header-anchor">#</a> æ— å…³ç´§è¦æ€»ç»“</h1> <p>è¿™æ˜¯ Webpack åŸç†åˆ†æç³»åˆ—ç¬¬ä¸ƒç¯‡æ–‡ç« ï¼Œè¯´å®è¯æœ€å¼€å§‹å¹¶æ²¡æœ‰æƒ³åˆ°èƒ½å†™è¿™ä¹ˆå¤šï¼Œåç»­è¿˜ä¼šç»§ç»­ focus åœ¨è¿™ä¸ªå‰ç«¯å·¥ç¨‹åŒ–é¢†åŸŸï¼Œæˆ‘çš„ç›®æ ‡æ˜¯èƒ½æ”’æˆä¸€æœ¬è‡ªå·±çš„ä¹¦ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦æ¬¢è¿ç‚¹èµå…³æ³¨ï¼Œå¦‚æœè§‰å¾—æœ‰ä»€ä¹ˆåœ°æ–¹é—æ¼ã€ç–‘æƒ‘ï¼Œæ¬¢è¿è¯„è®ºè®¨è®ºã€‚</p> <p><img src="http://mmbiz.qpic.cn/mmbiz_png/3xDuJ3eiciblkrkIk3XeyL1jc2o7J5FUibbjapRDRicM4S9rFHhoJFK8EBW9SWf8CPO8pSSanB9oo3dD4VPThlbeeA/0?wx_fmt=png" alt="Tecvan"></p> <p><strong>Tecvan</strong></p> <p>ä¸“æ³¨å‰ç«¯æ¡†æ¶æºç è§£è¯»</p> <p>18ç¯‡åŸåˆ›å†…å®¹</p> <p>å…¬ä¼—å·</p> <blockquote><p>å¾€æœŸæ–‡ç« </p> <ul><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYwMjcxMA==&amp;mid=2247484005&amp;idx=1&amp;sn=ae3e478259a50c54e0282b2efbc28c3f&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">åˆ†äº«å‡ ä¸ª Webpack å®ç”¨åˆ†æå·¥å…·<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>[å»ºè®®æ”¶è—] Webpack 4+ ä¼˜ç§€å­¦ä¹ èµ„æ–™åˆé›†</li> <li>[<a href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYwMjcxMA==&amp;mid=2247483744&amp;idx=1&amp;sn=d7128a76eed20746cd8c5100f0899138&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">ä¸‡å­—æ€»ç»“] ä¸€æ–‡åƒé€ Webpack æ ¸å¿ƒåŸç†<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>[<a href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYwMjcxMA==&amp;mid=2247483941&amp;idx=1&amp;sn=ce7597dfc8784e66d3c58f0e8df51f6b&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">æºç è§£è¯»] Webpack æ’ä»¶æ¶æ„æ·±åº¦è®²è§£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYwMjcxMA==&amp;mid=2247483956&amp;idx=1&amp;sn=a2066fcc76cd97de88a6d6cb397e6c2a&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">ååˆ†é’Ÿç²¾è¿› Webpackï¼šmodule.issuer å±æ€§è¯¦è§£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYwMjcxMA==&amp;mid=2247483743&amp;idx=1&amp;sn=0ce0845ee3e5316bcac05993035de3ed&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">æœ‰ç‚¹éš¾çš„ webpack çŸ¥è¯†ç‚¹ï¼šDependency Graph æ·±åº¦è§£æ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYwMjcxMA==&amp;mid=2247484029&amp;idx=1&amp;sn=7862737524e799c5eaf1605325171e32&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">æœ‰ç‚¹éš¾çš„çŸ¥è¯†ç‚¹ï¼šWebpack Chunk åˆ†åŒ…è§„åˆ™è¯¦è§£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYwMjcxMA==&amp;mid=2247484088&amp;idx=1&amp;sn=41bf509a72f2cbcca1521747bf5e28f4&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">Webpack åŸç†ç³»åˆ—å…­ï¼šå½»åº•ç†è§£ Webpack è¿è¡Œæ—¶<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">5/8/2024, 3:01:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—ä¸€-ä¸€æ–‡åƒé€Webpackæ ¸å¿ƒåŸç†.html" class="prev">
        ä¸€æ–‡åƒé€ Webpack æ ¸å¿ƒåŸç†
      </a></span> <span class="next"><a href="/webpack/1-webpackåŸç†/WebpackåŸç†ç³»åˆ—ä¹-Tree-Shakingå®ç°åŸç†.html">
        Webpack åŸç†ç³»åˆ—ä¹ï¼šTree-Shakingå®ç°åŸç†
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.04fd048c.js" defer></script><script src="/assets/js/2.57da4f88.js" defer></script><script src="/assets/js/1.a76cc220.js" defer></script><script src="/assets/js/49.3039c755.js" defer></script>
  </body>
</html>
