<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>esbuild 为什么这么快? | duangdong的engineering</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?0088ce24040b03f2947322ab31d23414";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script>
  var _hmt = _hmt || [];
  _hmt.push(['_requirePlugin', 'UrlChangeTracker', {
    shouldTrackUrlChange: function (newPath, oldPath) {
      newPath = newPath.split('#')[0];
      oldPath = oldPath.split('#')[0];
      return newPath != oldPath;
    }}
  ]);
  </script>
    <meta name="description" content="前端相关知识归纳总结">
    <meta name="keywords" content="qd-blog,node,vuepress,leetcode,algorithm">
    
    <link rel="preload" href="/assets/css/0.styles.b4a844ec.css" as="style"><link rel="preload" href="/assets/js/app.04fd048c.js" as="script"><link rel="preload" href="/assets/js/2.57da4f88.js" as="script"><link rel="preload" href="/assets/js/1.a76cc220.js" as="script"><link rel="preload" href="/assets/js/62.dc705c01.js" as="script"><link rel="prefetch" href="/assets/js/10.50f73657.js"><link rel="prefetch" href="/assets/js/11.0390ceee.js"><link rel="prefetch" href="/assets/js/12.f88bec36.js"><link rel="prefetch" href="/assets/js/13.963ad03b.js"><link rel="prefetch" href="/assets/js/14.512f15b9.js"><link rel="prefetch" href="/assets/js/15.a674496c.js"><link rel="prefetch" href="/assets/js/16.ed7e507f.js"><link rel="prefetch" href="/assets/js/17.de667ca5.js"><link rel="prefetch" href="/assets/js/18.b44e84af.js"><link rel="prefetch" href="/assets/js/19.5b5ad6a1.js"><link rel="prefetch" href="/assets/js/20.6800493a.js"><link rel="prefetch" href="/assets/js/21.6589052c.js"><link rel="prefetch" href="/assets/js/22.f648d829.js"><link rel="prefetch" href="/assets/js/23.d80486b4.js"><link rel="prefetch" href="/assets/js/24.d1ded971.js"><link rel="prefetch" href="/assets/js/25.2b5651f2.js"><link rel="prefetch" href="/assets/js/26.be0532f1.js"><link rel="prefetch" href="/assets/js/27.601e9758.js"><link rel="prefetch" href="/assets/js/28.5f3c5013.js"><link rel="prefetch" href="/assets/js/29.b11be3d0.js"><link rel="prefetch" href="/assets/js/3.13e892f5.js"><link rel="prefetch" href="/assets/js/30.b5a85a3d.js"><link rel="prefetch" href="/assets/js/31.656e3cca.js"><link rel="prefetch" href="/assets/js/32.df47284c.js"><link rel="prefetch" href="/assets/js/33.cf2bef7f.js"><link rel="prefetch" href="/assets/js/34.b76a28cc.js"><link rel="prefetch" href="/assets/js/35.4656aa60.js"><link rel="prefetch" href="/assets/js/36.bc0d7be9.js"><link rel="prefetch" href="/assets/js/37.41e22cc1.js"><link rel="prefetch" href="/assets/js/38.9a20d42b.js"><link rel="prefetch" href="/assets/js/39.5d96398a.js"><link rel="prefetch" href="/assets/js/4.5bdb9365.js"><link rel="prefetch" href="/assets/js/40.fb9028aa.js"><link rel="prefetch" href="/assets/js/41.96d148c1.js"><link rel="prefetch" href="/assets/js/42.26c75454.js"><link rel="prefetch" href="/assets/js/43.59ed847d.js"><link rel="prefetch" href="/assets/js/44.4c9bed25.js"><link rel="prefetch" href="/assets/js/45.547c992f.js"><link rel="prefetch" href="/assets/js/46.d63785ae.js"><link rel="prefetch" href="/assets/js/47.34a532a7.js"><link rel="prefetch" href="/assets/js/48.81fda019.js"><link rel="prefetch" href="/assets/js/49.3039c755.js"><link rel="prefetch" href="/assets/js/5.7c68fdb5.js"><link rel="prefetch" href="/assets/js/50.bd461786.js"><link rel="prefetch" href="/assets/js/51.b83fa154.js"><link rel="prefetch" href="/assets/js/52.6880a119.js"><link rel="prefetch" href="/assets/js/53.f60e17c7.js"><link rel="prefetch" href="/assets/js/54.833a4f5c.js"><link rel="prefetch" href="/assets/js/55.ed6a7c66.js"><link rel="prefetch" href="/assets/js/56.c9eef7e1.js"><link rel="prefetch" href="/assets/js/57.abbfb924.js"><link rel="prefetch" href="/assets/js/58.c1df5fda.js"><link rel="prefetch" href="/assets/js/59.1615eb2d.js"><link rel="prefetch" href="/assets/js/6.c8da7ca7.js"><link rel="prefetch" href="/assets/js/60.a1480688.js"><link rel="prefetch" href="/assets/js/61.901ae4d3.js"><link rel="prefetch" href="/assets/js/63.a3367f7e.js"><link rel="prefetch" href="/assets/js/64.44397e2a.js"><link rel="prefetch" href="/assets/js/65.b6f8a966.js"><link rel="prefetch" href="/assets/js/66.305bd539.js"><link rel="prefetch" href="/assets/js/67.b47bf615.js"><link rel="prefetch" href="/assets/js/68.63565465.js"><link rel="prefetch" href="/assets/js/69.141e956c.js"><link rel="prefetch" href="/assets/js/7.e4c88d0e.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5143d2e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4a844ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">duangdong的engineering</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/webpack/" class="nav-link router-link-active">
  Webpack
</a></div><div class="nav-item"><a href="/webpack-explain/" class="nav-link">
  深入浅出Webpack
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  Babel
</a></div><div class="nav-item"><a href="/micro-front/" class="nav-link">
  微前端
</a></div><div class="nav-item"><a href="https://link.aduang.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/webpack/" class="nav-link router-link-active">
  Webpack
</a></div><div class="nav-item"><a href="/webpack-explain/" class="nav-link">
  深入浅出Webpack
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  Babel
</a></div><div class="nav-item"><a href="/micro-front/" class="nav-link">
  微前端
</a></div><div class="nav-item"><a href="https://link.aduang.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/webpack/" aria-current="page" class="sidebar-link">前端工程化</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1-webpack原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2-webpack优化</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/webpack/Koa2中使用webpack进行打包压缩.html" class="sidebar-link">Koa2中使用webpack进行打包压缩</a></li><li><a href="/webpack/esbuild为什么这么快.html" class="active sidebar-link">esbuild 为什么这么快?</a></li><li><a href="/webpack/module-issuer属性详解.html" class="sidebar-link">十分钟精进 Webpack：module.issuer 属性详解</a></li><li><a href="/webpack/webpack-node.html" class="sidebar-link">Node中使用webpack打包时出现的错误和警告</a></li><li><a href="/webpack/不要再看loader原理了，自己写一个就什么都明白了.html" class="sidebar-link">不要再看loader原理了，自己写一个就什么都明白了</a></li><li><a href="/webpack/分享几个Webpack实用分析工具.html" class="sidebar-link">分享几个 Webpack 实用分析工具</a></li><li><a href="/webpack/如何开发VSCode-LSP服务.html" class="sidebar-link">实例解析：如何开发 VSCode LSP 服务</a></li><li><a href="/webpack/如何调试Webpack问题.html" class="sidebar-link">我是如何调试 Webpack 问题的</a></li><li><a href="/webpack/手把手带你入门Webpack-Plugin.html" class="sidebar-link">手把手带你入门 Webpack Plugin</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="esbuild-为什么这么快"><a href="#esbuild-为什么这么快" class="header-anchor">#</a> esbuild 为什么这么快?</h2> <h1 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h1> <p><code>esbuild</code> 是新一代的 JavaScript 打包工具。</p> <p><code>esbuild</code>以<code>速度快</code>而著称，耗时只有 webpack 的 2% ～3%。</p> <p><code>esbuild</code> 项目主要目标是: <code>开辟一个构建工具性能的新时代，创建一个易用的现代打包器</code>。</p> <p>它的主要功能：</p> <ul><li><code>Extreme speed without needing a cache</code></li> <li><code>ES6 and CommonJS modules</code></li> <li><code>Tree shaking of ES6 modules</code></li> <li><code>An API for JavaScript and Go</code></li> <li><code>TypeScript and JSX syntax</code></li> <li><code>Source maps</code></li> <li><code>Minification</code></li> <li><code>Plugins</code></li></ul> <p>现在很多工具都内置了它，比如我们熟知的:</p> <ul><li><code>vite</code>,</li> <li><code>snowpack</code></li></ul> <p>借助 esbuild 优异的性能， vite 更是如虎添翼， 快到飞起。</p> <p>今天我们就来探索一下: 为什么 esbuild 这么快?</p> <p>下文的主要内容：</p> <ul><li><code>几组性能数据对比</code></li> <li><code>为什么 esbuild 这么快</code></li> <li><code>esbuild upcoming roadmap</code></li> <li><code>esbuild 在 vite 中的运用</code></li> <li><code>为什么生产环境仍需打包?</code></li> <li><code>为何vite不用 esbuild 打包？</code></li> <li><code>总结</code></li></ul> <h1 id="正文"><a href="#正文" class="header-anchor">#</a> 正文</h1> <p>先看一组对比：</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/pTwqLfWKewCv0ozo69wA6CibHdgUDTUe6oS948cPTtnBm3wLY2K4bQxzzqrrel7tIQ0ZEk4ia06tewlMh9y4fM1Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p> <p>使用 10 份 threeJS 的生产包，对比不同打包工具在默认配置下的打包速度。</p> <p>webpack5 垫底， 耗时 <code>55.25</code>秒。</p> <p>esbuild 仅耗时 <code>0.37</code> 秒。</p> <p>差异巨大。</p> <p>还有更多对比：</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/pTwqLfWKewCv0ozo69wA6CibHdgUDTUe6gWXCNCZlkP23gva8vsgwP18IUGpblWNh6NfJLeHmxlPXwFFImIZibAA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">https://twitter.com/evanwallace/status/1314121407903617025</p> <p>webpack5 表示很受伤: 我还比不过 webpack 4 ?</p> <p>...</p> <h2 id="为什么-esbuild-这么快"><a href="#为什么-esbuild-这么快" class="header-anchor">#</a> 为什么 esbuild 这么快 ？</h2> <p>有以下几个原因。</p> <p>(为了保证内容的准确性， 以下内容翻译自 esbuild 官网。)</p> <h3 id="_1-它是用-go-语言编写的-并可以编译为本地代码。"><a href="#_1-它是用-go-语言编写的-并可以编译为本地代码。" class="header-anchor">#</a> 1. 它是用 Go 语言编写的，并可以编译为本地代码。</h3> <p>大多数打包器都是用 JavaScript 编写的，但是对于 <code>JIT 编译</code>的语言来说，命令行应用程序拥有最差的性能表现。</p> <p>每次运行打包器时，JavaScript VM 都会在没有任何优化提示的情况下看到打包程序的代码。</p> <p>在 esbuild 忙于解析 JavaScript 时，node 忙于解析打包程序的JavaScript。</p> <p>到节点完成解析打包程序代码的时间时，esbuild可能已经退出，您的打包程序甚至还没有开始打包。</p> <p>另外，Go 是为<code>并行性</code>而设计的，而 JavaScript 不是。</p> <p>Go在线程之间<code>共享内存</code>，而JavaScript必须在线程之间序列化数据。</p> <p>Go 和 JavaScript都有<code>并行的垃圾收集器</code>，但是Go的堆在<code>所有线程</code>之间共享，而对于JavaScript, 每个JavaScript线程中都有一个<code>单独的堆</code>。</p> <p>根据测试，这似乎将 JavaScript worker 线程的并行能力减少了一半，大概是因为一半CPU核心正忙于为另一半收集垃圾。</p> <h3 id="_2-大量使用了并行操作。"><a href="#_2-大量使用了并行操作。" class="header-anchor">#</a> 2. 大量使用了并行操作。</h3> <p>esbuild 中的<code>算法经过精心设计</code>，可以充分利用CPU资源。</p> <p>大致分为三个阶段：</p> <ol><li><code>解析</code></li> <li><code>链接</code></li> <li><code>代码生成</code></li></ol> <p><code>解析</code>和<code>代码生成</code>是大部分工作，并且可以<code>完全并行化</code>（链接在大多数情况下是固有的串行任务）。</p> <p>由于所有线程<code>共享内存</code>，因此当捆绑导入同一JavaScript库的不同入口点时，可以轻松地共享工作。</p> <p>大多数现代计算机具有<code>多内核</code>，因此并行性是一个巨大的胜利。</p> <h3 id="_3-代码都是自己写的-没有使用第三方依赖。"><a href="#_3-代码都是自己写的-没有使用第三方依赖。" class="header-anchor">#</a> 3. 代码都是自己写的， 没有使用第三方依赖。</h3> <p>自己编写所有内容, 而不是使用第三方库，可以带来很多性能优势。</p> <p>可以从一开始就牢记性能，可以确保所有内容都使用一致的数据结构来避免昂贵的转换，并且可以在必要时进行广泛的体系结构更改。缺点当然是多了很多工作。</p> <p>例如，许多捆绑程序都使用官方的TypeScript编译器作为解析器。</p> <p>但是，它是为实现TypeScript编译器团队的目标而构建的，它们没有将性能作为头等大事。</p> <h3 id="_4-内存的高效利用。"><a href="#_4-内存的高效利用。" class="header-anchor">#</a> 4. 内存的高效利用。</h3> <p>理想情况下， 根据数据数据的长度， 编译器的复杂度为O(n).</p> <p>如果要处理大量数据，内存访问速度可能会严重影响性能。</p> <p>对数据进行的遍历次数越少（将数据转换成数据所需的不同表示形式也就越少），编译器就会越快。</p> <p>例如，esbuild 仅触及整个JavaScript AST 3次：</p> <ol><li>进行词法分析，解析，作用域设置和声明符号的过程</li> <li>绑定符号，最小化语法。比如：将 JSX / TS转换为 JS, ES Next 转换为 es5。</li> <li>最小标识符，最小空格，生成代码。</li></ol> <p>当 AST 数据在CPU缓存中仍然处于活跃状态时，会最大化AST数据的重用。</p> <p>其他打包器在单独的过程中执行这些步骤，而不是将它们交织在一起。</p> <p>它们也可以在数据表示之间进行转换，将多个库组织在一起(例如:字符串→TS→JS→字符串，然后字符串→JS→旧的JS→字符串，然后字符串→JS→minified JS→字符串)。</p> <p>这样会占用更多内存，并且会减慢速度。</p> <p>Go的另一个好处是它可以将内容紧凑地存储在内存中，从而使它可以使用更少的内存并在CPU缓存中容纳更多内容。</p> <p>所有对象字段的类型和字段都紧密地包装在一起，例如几个布尔标志每个仅占用一个字节。</p> <p>Go 还具有值语义，可以将一个对象直接嵌入到另一个对象中，因此它是'免费的'，无需另外分配。</p> <p>JavaScript不具有这些功能，还具有其他缺点，例如 JIT 开销（例如隐藏的类插槽）和低效的表示形式（例如，非整数与指针堆分配）。</p> <p>以上的每一条因素， 都能在一定程度上提高编译速度。</p> <p>当它们共同工作时，效果比当今通常使用的其他打包器快几个数量级。</p> <p>以上内容比较繁琐，对此，也有一些网友做了简要的总结:</p> <ul><li>它是用 <code>Go</code> 语言编写的，该语言可以编译为本地代码。而且 Go 的执行速度很快。一般来说，JS 的操作是<code>毫秒级</code>，而 Go 则是<code>纳秒级</code>。</li> <li><code>解析</code>，生成最终打包文件和生成 source maps 的操作全部完全并行化</li> <li><code>无需昂贵的数据转换</code>，只需很少的几步即可完成所有操作</li> <li>该库<code>以提高编译速度为编写代码时的第一原则</code>，并尽量避免不必要的内存分配。</li></ul> <p>仅作参考。</p> <h2 id="upcoming-roadmap"><a href="#upcoming-roadmap" class="header-anchor">#</a> Upcoming roadmap</h2> <p>以下这几个 feature 已经在进行中了, 而且是第一优先级：</p> <ol><li><code>Code splitting</code> (#16, docs)</li> <li><code>CSS content type</code> (#20, docs)</li> <li><code>Plugin API</code> (#111)</li></ol> <p>下面这几个 fearure 比较有潜力, 但是还不确定：</p> <ol><li><code>HTML content type</code> (#31)</li> <li><code>Lowering to ES5</code> (#297)</li> <li><code>Bundling top-level await</code> (#253)</li></ol> <p>感兴趣的可以保持关注。</p> <h2 id="esbuild-在-vite-中的运用"><a href="#esbuild-在-vite-中的运用" class="header-anchor">#</a> esbuild 在 vite 中的运用</h2> <p><code>vite</code> 中大量使用了 <code>esbuild</code>, 这里简单分享两点。</p> <ol><li><code>optimizer</code></li></ol> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/pTwqLfWKewCv0ozo69wA6CibHdgUDTUe6iciciaa0hwcic637YbPPYggWCDxZjByz6vhToNbclTme5OiaLuOBpibQ31eQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">https://github.com/vitejs/vite/blob/main/packages/vite/src/node/optimizer/index.ts#L262</p> <div class="language- extra-class"><pre class="language-text"><code>import { build, BuildOptions as EsbuildBuildOptions } from 'esbuild'

// ...
const result = await build({
    entryPoints: Object.keys(flatIdDeps),
    bundle: true,
    format: 'esm',
    external: config.optimizeDeps?.exclude,
    logLevel: 'error',
    splitting: true,
    sourcemap: true,
    outdir: cacheDir,
    treeShaking: 'ignore-annotations',
    metafile: true,
    define,
    plugins: [
      ...plugins,
      esbuildDepPlugin(flatIdDeps, flatIdToExports, config)
    ],
    ...esbuildOptions
  })

  const meta = result.metafile!

  // the paths in `meta.outputs` are relative to `process.cwd()`
  const cacheDirOutputPath = path.relative(process.cwd(), cacheDir)

  for (const id in deps) {
    const entry = deps[id]
    data.optimized[id] = {
      file: normalizePath(path.resolve(cacheDir, flattenId(id) + '.js')),
      src: entry,
      needsInterop: needsInterop(
        id,
        idToExports[id],
        meta.outputs,
        cacheDirOutputPath
      )
    }
  }

  writeFile(dataPath, JSON.stringify(data, null, 2))
</code></pre></div><ol><li>处理 <code>.ts</code> 文件</li></ol> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/pTwqLfWKewCv0ozo69wA6CibHdgUDTUe6nofONBRUwLv1ib9XBSgP6DJtriboxXrZzbOXFTedKJ6nhtrEB105DO9Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">https://github.com/vitejs/vite/commit/59035546db7ff4b7020242ba994a5395aac92802</p> <h2 id="为什么生产环境仍需打包"><a href="#为什么生产环境仍需打包" class="header-anchor">#</a> <code>为什么生产环境仍需打包?</code></h2> <p>尽管原生 <code>ESM</code> 现在得到了<code>广泛支持</code>，但由于嵌套导入会导致<code>额外的网络往返</code>，在生产环境中发布未打包的 ESM 仍然效率低下（即使使用 <code>HTTP/2</code>）。</p> <p>为了在生产环境中获得<code>最佳的加载性能</code>，最好还是将代码进行 <code>tree-shaking</code>、<code>懒加载</code>和 <code>chunk 分割</code>（以获得更好的<code>缓存</code>）。</p> <p>要确保<code>开发</code>服务器和<code>产品构建</code>之间的<code>最佳输出</code>和<code>行为</code>达到一致，并不容易。</p> <p>为解决这个问题，Vite 附带了一套 <code>构建优化</code> 的 <code>构建命令</code>，开箱即用。</p> <h2 id="为何-vite-不用-esbuild-打包"><a href="#为何-vite-不用-esbuild-打包" class="header-anchor">#</a> <code>为何 vite 不用 esbuild 打包？</code></h2> <p>虽然 <code>esbuild</code> 快得惊人，并且已经是一个在构建库方面比较出色的工具，但一些针对构建应用的重要功能仍然还在持续开发中 —— 特别是<code>代码分割</code>和 <code>CSS处理</code>方面。</p> <p>就目前来说，<code>Rollup</code> 在应用打包方面, 更加成熟和灵活。</p> <p>尽管如此，当未来这些功能稳定后，也不排除使用 esbuild 作为<code>生产构建器</code>的可能。</p> <h1 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h1> <p>esbuild 为构建提效带来了曙光， 而且 esm 的数量也在快速增加：</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/pTwqLfWKewCv0ozo69wA6CibHdgUDTUe6kXJhebo42byTQ5icOUph6BIzYWF7sXyibqumjfLMX9Lw2PxKicx9NamMQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">https://twitter.com/skypackjs/status/1113838647487287296</p> <p>希望 <code>esm</code> 生态尽快完善起来, 造福前端</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/8/2024, 3:01:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/webpack/Koa2中使用webpack进行打包压缩.html" class="prev">
        Koa2中使用webpack进行打包压缩
      </a></span> <span class="next"><a href="/webpack/module-issuer属性详解.html">
        十分钟精进 Webpack：module.issuer 属性详解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.04fd048c.js" defer></script><script src="/assets/js/2.57da4f88.js" defer></script><script src="/assets/js/1.a76cc220.js" defer></script><script src="/assets/js/62.dc705c01.js" defer></script>
  </body>
</html>
